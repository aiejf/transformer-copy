{% extends "bootstrap/base.html" %}

{% block title %}日本語誤りチェッカー{% endblock %}

{% block styles %}
{{ super() }}
<style>
    html {
        position: relative;
        min-height: 100%;
    }
    body {
        margin-bottom: 120px;
        height: auto;
        height: 100%;
    }
    #result {
        display: flex;
        flex-wrap: wrap;
    }
    .card-body-self {
        margin-top: 20px;
        background-color: aliceblue;
    }
    .result-box {
        margin: 10px;
        padding: 10px;
    }
    .footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        height: 60px;
        background-color: #f5f5f5;
        text-align: center;
    }
    body>.container {
        padding: 60px 15px 0;
    }
    .container .text-muted {
        margin: 20px 0;
    }
    .footer>.container {
        padding-right: 15px;
        padding-left: 15px;
    }
</style>
{% endblock %}


{% block content %}
<div class="container">
  <h1>日本語誤りチェッカー</h1>
  <hr>
  <form>
    <div class="form-group">
      <textarea class="form-control" id="input_text" rows="5" maxlength="300" name="input_text"
                placeholder="ここに文を入力"></textarea>
    </div>
    <br>
    <button type="submit" id="submit-btn" class="btn btn-primary btn-lg btn-block">
      訂正する
    </button>
  </form>

  <br>
  <div class="card">
    <div class="card-header">結果</div>
    <div class="card-body card-body-self">
      <div id="result"></div>
    </div>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="text-muted">長岡技術科学大学 自然言語処理研究室</p>
  </div>
</footer>
{% endblock %}


{% block scripts %}
{{ super() }}
<script>
  function ajax(text) {
    return $.ajax({
      type: "GET",
      url: "{{ prefix }}/api",
      data: { "input_text": text },
      contentType: "application/JSON",
      dataType: "json",
      scriptCharset: "UTF-8",
      timeout: 1000,
      async: false
    })
  }

  $("#submit-btn").on("click", function() {
    event.preventDefault();
    $("#result").html("");
    var text = $("#input_text").val();
    ajax(text).done(function(result) {
      for (i in result["res"]) {
        var res = result["res"][i];
        console.log(res)
        var hypo_raw = res["best_hypo_raw"];
        var hypo = $("<div class='result-box'>" + hypo_raw + "</div>");
        $("#result").append(hypo);
      }
    }).fail(function() {
      console.log("error");
    });
  });
</script>
{% endblock %}
